# フェーズ5.8: Shared Element Transition機能の実装

## 何を (What)

記事カードから記事詳細ページへの遷移時に、framer-motionの`layoutId`機能を使用して、カードの画像、タイトル、日時、要約が連続的にアニメーションしながら詳細ページに遷移する機能を実装しました。

### 実装した機能

1. **記事カードコンポーネントの拡張**
   - framer-motionの`motion.article`、`motion.img`、`motion.h3`、`motion.time`、`motion.p`を導入
   - 各要素に一意の`layoutId`を設定し、Shared Element Transitionの基盤を構築
   - 記事カードのホバーアニメーションを追加

2. **記事詳細ページコンポーネントの追加**
   - 新規に`PostHeader`コンポーネントを作成（クライアントコンポーネント）
   - 画像、タイトル、日時、要約を統合し、Shared Element Transitionを実現
   - 記事詳細ページのメタ情報表示を最適化

3. **アニメーションの高速化と最適化**
   - 参考サイト（azukiazusa.dev）を参考に、アニメーション時間を短縮
   - よりスナッピーで自然な遷移を実現

### 変更されたファイル

- `app/presentation/components/blog/post-card.tsx` - 記事カードコンポーネントにframer-motionのlayoutIdを追加
- `app/presentation/components/blog/post-header.tsx` - 新規作成（画像・タイトル・日時・要約コンポーネント）
- `app/app/blog/[slug]/page.tsx` - PostHeaderコンポーネントを使用するように更新

## どんな目的で (Why)

記事一覧から記事詳細への遷移を視覚的に連続性のあるアニメーションで表現することで、ユーザーエクスペリエンスを向上させることが目的です。azukiazusa.devのようなモダンなブログサイトと同様の高度な遷移効果を実現し、プロフェッショナルな印象を与えるポートフォリオサイトを構築するためです。

また、画像、タイトル、日時、要約といった主要な要素が連続的に遷移することで、ユーザーがどの記事を開いたかを視覚的に認識しやすくなり、ナビゲーションの改善にもつながります。

## どう変更したか (How)

### 記事カードコンポーネントの拡張

記事カードコンポーネントにframer-motionを導入し、各要素に一意の`layoutId`を設定しました。これにより、記事詳細ページの同じIDを持つ要素と自動的に連携し、位置やサイズが補間されるアニメーションが発生します。

記事カード全体を`motion.article`でラップし、画像、タイトル、日時、要約にそれぞれ個別の`layoutId`を設定しました。ホバー時の微細なアニメーションも追加し、インタラクティブな体験を提供します。

### 記事詳細ページコンポーネントの作成

記事詳細ページの画像、タイトル、日時、要約を統合した新規の`PostHeader`コンポーネントを作成しました。このコンポーネントはクライアントコンポーネントとして実装し、framer-motionのアニメーション機能を活用します。

記事カードと同じ`layoutId`を持つ要素を配置することで、ページ遷移時にframer-motionが自動的に位置やサイズを補間し、スムーズな遷移アニメーションを実現します。各要素には適切なタイミングでフェードインするアニメーションも追加しました。

### アニメーション時間の最適化

参考サイトの動作を分析し、アニメーション時間を全体的に短縮しました。記事カードの初期表示アニメーションを0.2秒から0.15秒に、詳細ページのフェードインを0.3秒から0.15秒に短縮し、ディレイも大幅に削減しました。

Shared Element Transitionのlayoutアニメーションには0.2秒のdurationとeaseOutのイージング関数を設定し、より自然でスピーディな遷移を実現しています。これにより、ユーザーは素早くコンテンツにアクセスでき、快適な閲覧体験を提供できます。

## 考えられる影響と範囲

### ユーザーエクスペリエンスへの影響

- 記事一覧から詳細への遷移が視覚的に連続的になり、どの記事を開いたかが明確になる
- アニメーションが高速化されたことで、よりスナッピーで現代的な印象を与える
- モバイルデバイスでも滑らかなアニメーションが動作し、操作性が向上

### パフォーマンスへの影響

- framer-motionのlayoutアニメーションはGPUアクセラレーションを活用し、パフォーマンスへの影響は最小限
- アニメーション時間が短縮されたことで、実際の処理時間が削減され、体感的な速度が向上

### 技術的影響

- クライアントコンポーネントの追加により、サーバーコンポーネントとの分離が明確になった
- コンポーネントの責務が明確になり、保守性が向上
- 今後のアニメーション機能追加時の拡張性が確保された

## アニメーション時間設定

### 記事カードコンポーネント

| 要素 | プロパティ | duration | delay | イージング | 備考 |
|------|-----------|----------|-------|-----------|------|
| `motion.article` | transition | **0.15秒** | - | easeOut | カード全体の初期表示・ホバー |
| `motion.img` | layout transition | **0.2秒** | - | easeOut | Shared Element Transition |
| `motion.img` | CSS transition | **0.2秒** | - | - | ホバー時の拡大アニメーション |
| `motion.h3` | layout transition | **0.2秒** | - | easeOut | Shared Element Transition |
| `motion.time` | layout transition | **0.2秒** | - | easeOut | Shared Element Transition |
| `motion.p` | layout transition | **0.2秒** | - | easeOut | Shared Element Transition |

### 記事詳細ページ（PostHeaderコンポーネント）

| 要素 | layout duration | opacity duration | delay | イージング | 備考 |
|------|----------------|------------------|-------|-----------|------|
| `motion.div` (画像) | **0.2秒** | **0.15秒** | - | easeOut | Shared Element Transition + フェードイン |
| `motion.h1` (タイトル) | **0.2秒** | **0.15秒** | **0.05秒** | easeOut | Shared Element Transition + フェードイン |
| `motion.time` (日時) | **0.2秒** | **0.15秒** | **0.08秒** | easeOut | Shared Element Transition + フェードイン |
| `motion.div` (要約) | **0.2秒** | **0.15秒** | **0.1秒** | easeOut | Shared Element Transition + フェードイン |

### アニメーションの流れ

記事詳細ページの表示順序（delay）:
1. 画像: 即座（delay: 0秒）
2. タイトル: 0.05秒後
3. 日時: 0.08秒後
4. 要約: 0.1秒後

### 設定値のまとめ

- **最短duration**: 0.15秒（フェードインアニメーション）
- **標準duration**: 0.2秒（Shared Element Transition）
- **最大delay**: 0.1秒（要約）
- **総アニメーション時間**: 約0.25秒（delay 0.1秒 + duration 0.15秒）

## 課題

### 現在の制約事項

- モバイルデバイスでのパフォーマンス検証が未実施
- 非常に長いコンテンツを持つ記事でのアニメーション挙動の検証が必要
- ブラウザの戻るボタンを使用した際のアニメーション挙動の確認が必要

### 今後の改善点

- モバイルデバイスでのパフォーマンス最適化（必要に応じてアニメーションを簡略化）
- アクセシビリティの観点から、prefers-reduced-motionメディアクエリへの対応を検討
- アニメーション時間を設定ファイルから制御できるようにして、柔軟性を向上

